{"type":"page","id":"page_task_debug","body":[{"type":"tabs","tabs":[{"title":"实时任务池","body":[{"type":"crud","id":"u:d3c77f91b128","messages":{},"themeConfig":{},"columns":[{"type":"operation","label":"操作","buttons":[{"label":"编辑","type":"button","actionType":"dialog","level":"link","dialog":{"title":"编辑","body":{"type":"form","body":[{"name":"id","label":"id","id":"u:d7d27d200069","type":"input-text"},{"name":"state","label":"状态","id":"u:a25037a6ab36","placeholder":"-","sortable":true,"type":"input-text"},{"label":"类型path","name":"taskTypePath","id":"u:14e58abf1028","placeholder":"-","sortable":true,"searchable":true,"type":"input-text"},{"label":"任务包","name":"isTaskPackage","id":"u:d92f0aa08ccc","type":"select","options":["true","false"]},{"label":"运算单元","name":"scheduleUid","id":"u:60c9eb9aca94","placeholder":"-","sortable":true,"type":"input-text"},{"label":"执行单元","name":"executionUnitId","id":"u:8a37e14bc370","placeholder":"-","sortable":true,"type":"input-text"}]}},"id":"u:535d662406f6"},{"id":"u:316d5f8b8a1d","type":"button","label":"执行","level":"link","onEvent":{"click":{"weight":0,"actions":[{"args":{"options":{},"api":{"url":"/api/v1/reentertask4DebugTool/${id}","method":"get","messages":{"success":"执行成功！"},"requestAdaptor":"console.log('api')\nconsole.log(api)\n"}},"actionType":"ajax","outputVar":"responseResult"}]}}},{"type":"button","label":"触发Action","level":"link","onEvent":{"click":{"weight":0,"actions":[{"args":{"value":{"state":"${state}","taskType":"${taskTypePath}","trgTaskId":"${id}","trgTaskJson":"${startParamJson}"}},"actionType":"setValue","componentId":"page_task_debug"},{"actionType":"dialog","dialog":{"type":"dialog","title":"触发状态转换行为","body":[{"type":"radios","name":"trgAction","source":{"url":"/api/v1/tool/actions/$taskTypePath/$state","method":"get","messages":{},"adaptor":"data = { items: payload.data }\nreturn data;"},"id":"u:946a4c82dd59","label":"可触发行为"}],"showCloseButton":true,"showErrorMsg":true,"showLoading":true,"closeOnEsc":false,"id":"u:2efa29718f82","onEvent":{"confirm":{"weight":0,"actions":[{"args":{"options":{},"api":{"url":"/api/v1/taskaction/$trgTaskId/$trgAction?argJson=$trgTaskJson","method":"get","messages":{"success":"执行成功"}}},"actionType":"ajax","outputVar":"responseResult"}]}}}}]}},"id":"u:b55c5d4f48cb","themeConfig":{}}],"id":"u:4c2a72445636","name":"oper","placeholder":"-","popOver":false},{"type":"text","label":"id","name":"id","id":"u:d7d27d200069","placeholder":"-","width":""},{"label":"状态","name":"state","type":"text","id":"u:a25037a6ab36","placeholder":"-","sortable":true},{"type":"text","label":"类型path","name":"taskTypePath","id":"u:14e58abf1028","placeholder":"-","sortable":true,"searchable":true},{"type":"status","label":"任务包","name":"isTaskPackage","id":"u:d92f0aa08ccc"},{"type":"json","label":"json","name":"startParamJson","id":"u:7ccc1b83d18c","levelExpand":0},{"type":"text","label":"运算单元","name":"scheduleUid","id":"u:60c9eb9aca94","placeholder":"-","sortable":true},{"type":"text","label":"执行单元","name":"executionUnitId","id":"u:8a37e14bc370","placeholder":"-","sortable":true}],"syncLocation":false,"api":{"method":"post","url":"/api/v1/tasks/pager","messages":{},"dataType":"json","data":{"skipCount":0,"maxResultCount":100},"adaptor":"return {\n    data: {\n        items: payload.data.items,\n        total: payload.data.totalCount\n    }\n}"},"bulkActions":[{"label":"移除到临时","type":"button","id":"u:aa65dc68aa46","onEvent":{"click":{"weight":0,"actions":[{"args":{"options":{},"api":{"url":"/api/v1/removeTasks4DebugTool/","method":"post","messages":{},"dataType":"json","data":{"&":"$$"},"requestAdaptor":"console.log('api')\nconsole.log(api)\nconst ids = api.data.selectedItems.map(v => v.id);\napi.data = {\n  ids: ids\n}\nconsole.log(api)\nreturn api;"}},"actionType":"ajax","outputVar":"responseResult"},{"componentId":"u:d3c77f91b128","groupType":"component","actionType":"reload"}]}}}],"itemActions":[],"features":["create","bulkDelete","update","view"],"filterColumnCount":3,"filter":null,"loadDataOnce":true,"draggable":false,"mode":"table","footerToolbar":[{"type":"statistics"},{"type":"pagination"},{"type":"switch-per-page","tpl":"内容","wrapperComponent":"","id":"u:27f35ef7d586"}],"headerToolbar":[{"type":"bulk-actions"},{"type":"button","label":"刷新","tpl":"内容","wrapperComponent":"","id":"u:2578293b5726","onEvent":{"click":{"weight":0,"actions":[{"componentId":"u:d3c77f91b128","groupType":"component","actionType":"reload"}]}}}],"primaryField":"id"}],"id":"u:d89c89732021"},{"title":"实时日志","body":[{"type":"service","id":"u:1f48fe1caa2c","messages":{},"body":[{"type":"crud","columns":[{"name":"creationTime","label":"变更时间","type":"datetime","id":"u:843dd6cfcbe9"},{"name":"taskId","label":"任务号","type":"text","id":"u:4d1f4cbc8ee3"},{"name":"taskTypePath","label":"类型Path","type":"text","id":"u:7eaa60a0e26b"},{"name":"state","label":"变更状态","type":"text","id":"u:1492b4176fd0"},{"name":"scheduleUid","label":"scheduleUid","type":"text","id":"u:37caf43061b3"},{"name":"executionUnitId","label":"executionUnitId","type":"text","id":"u:8768b20f8635"}],"id":"u:be4444985732","perPageAvailable":[10],"messages":{},"headerToolbar":[{"type":"bulk-actions"},{"type":"button","tpl":"内容","wrapperComponent":"","id":"u:a3dfb89eb4ec","label":"刷新数据","onEvent":{"click":{"actions":[{"componentId":"u:1f48fe1caa2c","groupType":"component","actionType":"reload"}]}}}],"showHeader":true}],"data":{"maxCount":100},"api":{"url":"/api/v1/tasklogs/pager","method":"post","messages":{},"dataType":"json","data":{"skipCount":0,"maxResultCount":"${maxCount}"}}}],"id":"u:ed24d3ad6ef9"},{"title":"批量新增任务","body":[{"type":"service","body":[{"type":"crud","columns":[{"type":"text","label":"ID","name":"id","id":"u:bfc544c7bb22","sortable":true,"toggled":true,"width":100,"quickEdit":true},{"label":"状态","name":"state","type":"text","id":"u:6c21e8a80487","sortable":true,"searchable":true,"toggled":true,"quickEdit":true},{"label":"类型path","name":"taskTypePath","type":"text","id":"u:43914c051b06","sortable":true,"toggled":true},{"type":"status","label":"任务包","name":"isTaskPackage","id":"u:b0bbc41b386d","sortable":true,"toggled":true,"quickEdit":true},{"type":"text","label":"运算单元","name":"scheduleUid","id":"u:413408701cbf","quickEdit":true,"toggled":true},{"type":"text","label":"执行单元","name":"executionUnitId","id":"u:d7427f640818","quickEdit":true,"toggled":true},{"name":"parenerId","label":"父级编号","quickEdit":true,"type":"text","toggled":true,"id":"u:c4b82d710ac6"},{"type":"operation","label":"操作","id":"u:5aaa09c13214","buttons":[{"label":"编辑","type":"button","actionType":"dialog","level":"link","dialog":{"title":"编辑","body":{"type":"form","body":[{"name":"id","label":"ID","sortable":true,"toggled":true,"width":100,"id":"u:bfc544c7bb22","type":"input-text"},{"name":"state","label":"状态","sortable":true,"searchable":true,"toggled":true,"id":"u:6c21e8a80487","quickEdit":true,"type":"input-text"},{"name":"taskTypePath","label":"类型path","sortable":true,"toggled":true,"id":"u:43914c051b06","type":"input-text"},{"name":"isTaskPackage","label":"任务包","sortable":true,"toggled":true,"id":"u:b0bbc41b386d","type":"input-text"},{"name":"scheduleUid","label":"运算单元","quickEdit":true,"toggled":true,"id":"u:413408701cbf","type":"input-text"},{"name":"executionUnitId","label":"执行单元","quickEdit":true,"toggled":true,"id":"u:d7427f640818","type":"input-text"}]}},"id":"u:bfc7e2025236","icon":""}]}],"id":"u:b93ee591b852","perPageAvailable":[10],"messages":{},"headerToolbar":[{"type":"button","label":"新增任务","level":"primary","id":"u:1e854c54ed62","onEvent":{"click":{"weight":0,"actions":[{"actionType":"dialog","dialog":{"type":"dialog","title":"弹框标题","body":[{"type":"form","title":"表单","body":[{"label":"ID","type":"input-text","name":"id","id":"u:c6563a7dd9e3"},{"type":"input-text","label":"状态","name":"state","id":"u:7a2036163306"},{"type":"input-text","label":"类型Path","name":"taskTypePath","id":"u:7ada7286faf5"},{"type":"radios","label":"是否任务包","name":"isTaskPackage","value":false,"options":[{"label":"是","value":true},{"label":"否","value":false}],"id":"u:7a2036163306"},{"type":"radios","label":"startParamIsResponse","name":"startParamIsResponse","value":true,"options":[{"label":"是","value":true},{"label":"否","value":false}]},{"type":"input-text","label":"运算单元","name":"scheduleUid","id":"u:3da0aab4c257"},{"type":"input-text","label":"执行单元","name":"executionUnitId","id":"u:495db5610c88"},{"type":"input-text","label":"父级编号","name":"parentId","id":"u:82d58078551c"}],"id":"u:97bfbdac269d"}],"showCloseButton":true,"showErrorMsg":true,"showLoading":true,"id":"u:654607b65d41","closeOnEsc":false,"onEvent":{"confirm":{"weight":0,"actions":[{"actionType":"custom","script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation = true;可以阻止后续动作执行\n*/\nconsole.log('context')\nconsole.log(context)\nconsole.log('context.props')\nconsole.log(context.props)\nconst { items } = context.props.data;\nconst newData = event.data;\nconsole.log('newData');\nconsole.log(newData);\nlet newListLen = items.push(newData)\nconsole.log('newListLen')\nconsole.log(newListLen)\ndoAction({\n  actionType: 'setValue',\n  componentId: \"page_task_debug\",\n  args: {\n    value: { tmpTasks: items }\n  }\n});\n"},{"componentId":"u:b93ee591b852","groupType":"component","actionType":"reload"}]}}}}]}},"editorState":"default","themeConfig":{}},{"type":"bulk-actions"}],"source":"${tmpTasks}","api":{"method":"get","url":""},"expandConfig":{"expand":"all"},"draggable":true,"bulkActions":[{"type":"button","level":"danger","label":"批量删除","actionType":"ajax","id":"u:fbbd1357fd6b","onEvent":{"click":{"weight":0,"actions":[{"actionType":"custom","script":"/* 自定义JS使用说明：\n  * 1.动作执行函数doAction，可以执行所有类型的动作\n  * 2.通过上下文对象context可以获取当前组件实例，例如context.props可以获取该组件相关属性\n  * 3.事件对象event，在doAction之后执行event.stopPropagation = true;可以阻止后续动作执行\n*/\nconst { currentPageData, selectedItems, unSelectedItems } = context.props.data;\nconsole.log(unSelectedItems);\nconsole.log(selectedItems);\nconst sIds = selectedItems.map(i => i.id);\nlet newList = unSelectedItems.filter(i => sIds.indexOf(i.id) == -1);\nconsole.log('newList')\nconsole.log(newList)\ndoAction({\n  actionType: 'setValue',\n  componentId: \"page_task_debug\",\n  args: {\n    value: { tmpTasks: newList }\n  }\n});\n"},{"componentId":"u:b93ee591b852","groupType":"component","actionType":"reload"}]}},"editorState":"default"},{"label":"提交到任务池","type":"button","id":"u:3d19ac45e15b","onEvent":{"click":{"weight":0,"actions":[{"args":{"options":{},"api":{"url":"/api/v1/tasklist","method":"post","dataType":"json","data":{"&":"$$"},"requestAdaptor":"const { selectedItems } = api.data;\napi.data = { tasks: selectedItems };","adaptor":"const data = { ...payload, status: 1, msg: payload.message }\nconsole.log('ada  data')\nconsole.log(data)\nreturn data;","replaceData":false}},"actionType":"ajax","outputVar":"responseResult"}]}},"editorState":"default"}],"itemActions":[],"features":["update","create","bulkDelete","delete"],"saveOrderApi":"/amis/api/mock2/form/saveData"}],"id":"addTaskSvc","messages":{},"data":{},"themeConfig":{},"dataProvider":"","name":"服务"}],"id":"u:dc291d5a5179","themeConfig":{}}],"id":"u:38e3ec28b419","themeConfig":{}}],"asideResizor":false,"pullRefresh":{"disabled":true},"regions":["body"],"data":{"tmpTasks":[]},"themeConfig":{}}